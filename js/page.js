/*! For license information please see page.js.LICENSE.txt */
(globalThis.webpackChunksakurairo_scripts=globalThis.webpackChunksakurairo_scripts||[]).push([[2530],{6841:()=>{window.grin=function(e,t,n,o){const a=document.getElementById("comment");if(!a||"textarea"!=a.type)return!1;switch(t){case"custom":e=n+e+o;break;case"Img":e="[img]"+e+"[/img]";break;case"Math":e=" {{"+e+"}} ";break;case"tieba":e=" ::"+e+":: ";break;default:e=" :"+e+": "}if(a.selectionStart||"0"==a.selectionStart){let t=a.selectionStart,n=a.selectionEnd,o=n;a.value=a.value.substring(0,t)+e+a.value.substring(n,a.value.length),o+=e.length,a.focus(),a.selectionStart=o,a.selectionEnd=o}else a.value+=e,a.focus()}},421:(e,t,n)=>{n(1954),n(876),n(2597),n(460),n(435),n(3080),n(234);var o=n(4237),a=n(2851),i=n(791);let s;function r(){!function(){const e=document.getElementsByClassName("collapseButton");if(e.length>0){const t=e=>{(0,a.mf)(e.currentTarget.nextElementSibling)};for(const n of e)n.addEventListener("click",t)}}(),async function(){if(_iro.baguetteBox){s||(s=(0,o.loadCSS)((0,i.o)("dist/baguetteBox.min.css","baguettebox.js","1.11.1")));const{default:e}=await n.e(494).then(n.t.bind(n,494,23));e.run(".entry-content",{captions:function(e){return e.getElementsByTagName("img")[0].alt},ignoreClass:"fancybox"})}else if(_iro.fancybox){if(s||(s=(0,o.loadCSS)((0,i.o)("dist/jquery.fancybox.min.css","@fancyapps/fancybox"))),!(window.jQuery instanceof Function||window.$ instanceof Function))if(_iro.ext_shared_lib)(0,i.J)("dist/jquery.slim.min.js","jquery");else{const{default:e}=await n.e(7569).then(n.t.bind(n,7569,23));window.$=e,window.jQuery=e}_iro.ext_shared_lib?(0,i.J)("dist/jquery.fancybox.min.js","@fancyapps/fancybox"):n.e(7639).then(n.t.bind(n,7639,23))}else if(_iro.lightGallery){const{default:e}=await Promise.all([n.e(2865),n.e(1862)]).then(n.bind(n,2865));e()}}(),async function(){if(document.getElementsByTagName("math").length>0||document.querySelector("article > div.entry-content")?.textContent.match(/(?:\$|\\\(|\\\[|\\begin\{.*?})/)){const e={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},startup:{typeset:!1},chtml:{fontURL:(0,i.o)("es5/output/chtml/fonts/woff-v2","mathjax"),mathmlSpacing:!0}};"MathJax"in window||(window.MathJax=e),await n.e(4247).then(n.t.bind(n,4247,23)),window.MathJax.typesetPromise()}}()}var l=n(8219),c=n(6460),d=(n(6841),n(5892)),u=n.n(d);const m=(e,t=80)=>"https://"+_iro.gravatar_url+"/"+u()(e)+".jpg?s="+t+"&d=mm";function h(){let e=!1;const t=document.querySelector("input#author"),n=document.querySelector("input#qq"),o=document.querySelector("input#email"),i=document.querySelector("input#url"),s=document.querySelector(".qq-check"),r=document.querySelector(".gravatar-check"),l=document.querySelector("div.comment-user-avatar img");if(null==t)return;localStorage.getItem("user_qq")||localStorage.getItem("user_qq_email")||localStorage.getItem("user_author")||(n.value=t.value=o.value=i.value=""),localStorage.getItem("user_avatar")&&localStorage.getItem("user_qq")&&localStorage.getItem("user_qq_email")&&(l.setAttribute("src",localStorage.getItem("user_avatar")),t.value=localStorage.getItem("user_author"),o.value=localStorage.getItem("user_qq")+"@qq.com",n.value=localStorage.getItem("user_qq"),_iro.qzone_autocomplete&&(i.value="https://user.qzone.qq.com/"+localStorage.getItem("user_qq")),n.value&&(s.style.display="block",r.style.display="none"));let c=o.value;t.addEventListener("blur",(()=>{const d=t.value;if(/^[1-9]\d{4,9}$/.test(d)){const u=()=>{n.value="",s.style.display="none",r.style.display="block",l.setAttribute("src",m(o.value,80)),localStorage.setItem("user_qq",""),localStorage.setItem("user_email",o.value),localStorage.setItem("user_avatar",m(o.value,80))};fetch((0,a.tG)(_iro.qq_api_url,{qq:d})).then((async a=>{if(a.ok)try{const u=await a.json();t.value=u.name,o.value=d.trim()+"@qq.com",_iro.qzone_autocomplete&&(i.value="https://user.qzone.qq.com/"+d.trim()),l.setAttribute("src","https://q2.qlogo.cn/headimg_dl?dst_uin="+d+"&spec=100"),e=!0,n.value=d.trim(),n.value&&(s.style.display="block",r.style.display="none"),localStorage.setItem("user_author",u.name),localStorage.setItem("user_qq",d),localStorage.setItem("is_user_qq","yes"),localStorage.setItem("user_qq_email",d+"@qq.com"),localStorage.setItem("user_email",d+"@qq.com"),c=o.value,l.setAttribute("src",u.avatar),localStorage.setItem("user_avatar",u.avatar)}catch(e){console.warn(e),u()}else u()}))}})),localStorage.getItem("user_avatar")&&localStorage.getItem("user_email")&&"no"==localStorage.getItem("is_user_qq")&&!localStorage.getItem("user_qq_email")&&(l.setAttribute("src",localStorage.getItem("user_avatar")),o.value=localStorage.getItem("user_mail"),n.value="",n.value||(s.style.display="none",r.style.display="block")),o.addEventListener("blur",(function(){let t=o.value;0!=e&&c==t||""==t||(l.setAttribute("src",m(t,80)),localStorage.setItem("user_avatar",m(t,80)),localStorage.setItem("user_email",t),localStorage.setItem("user_qq_email",""),localStorage.setItem("is_user_qq","no"),n.value="",n.value||(s.style.display="none",r.style.display="block"))})),localStorage.getItem("user_url")&&(i.value=localStorage.getItem("user_url")),i.addEventListener("blur",(function(){let e=i.value;i.value=e,localStorage.setItem("user_url",e)})),localStorage.getItem("user_author")&&(t.value=localStorage.getItem("user_author")),t.addEventListener("blur",(function(){let e=t.value;t.value=e,localStorage.setItem("user_author",e)}))}const f={respondId:"",moveForm:function(e,t,n){const o=document.getElementById(e),a=document.getElementById(n),i=document.getElementById("cancel-comment-reply-link"),s=document.getElementById("comment_parent");if(this.respondId=n,!document.getElementById("wp-temp-form-div")){const e=document.createElement("div");e.id="wp-temp-form-div",e.style.display="none",a.parentNode.insertBefore(e,a)}if(o)o.parentNode.insertBefore(a,o.nextSibling);else{const e=document.getElementById("wp-temp-form-div");document.getElementById("comment_parent").value="0",e.parentNode.insertBefore(a,e),e.remove()}const r=document.getElementById("respond");window.scrollTo({top:r.getBoundingClientRect().top+window.pageYOffset-r.clientTop-100,behavior:"smooth"}),s.value=t,i.style.display="",i.onclick=function(e){const t=f,n=document.getElementById("wp-temp-form-div"),o=document.getElementById(t.respondId);return document.getElementById("comment_parent").value="0",n&&o&&(n.parentNode.insertBefore(o,n),n.remove()),this.style.display="none",this.onclick=null,!1};try{document.getElementById("comment").focus()}catch(e){}return!1}},g=f;var p=n(7028);const v=e=>{const t=e.target;if(t===document.querySelector("#template-pagination a")){if(e.preventDefault(),e.stopPropagation(),t.classList.contains("loading"))return;t.classList.add("loading"),t.textContent="",fetch(t.dataset.href+"&_wpnonce="+_iro.nonce,{method:"POST"}).then((async e=>{const t=await e.json();if(!e.ok)throw Error(`Error, Status: ${e.status}`);document.getElementById("template-pagination").remove(),document.querySelector(".row").insertAdjacentHTML("beforeend",t),(0,l.A)()})).catch((e=>{console.error(e),(0,c.I)(e),t.classList.remove("loading"),t.innerHTML='<i class="fa-solid fa-triangle-exclamation"></i> ERROR '}))}};function y(){const e=document.getElementsByTagName("section");let t=!1;for(let n=0;n<e.length;n++)if(e[n].classList.contains("have-columns")){t=!0;break}t&&document.addEventListener("click",v)}var b=n(2707),w=n(6270);function _(){const e=document.getElementById("emotion-toggle"),t=document.querySelector(".emotion-box"),n=document.querySelector(".emotion-header"),o=document.querySelector(".comment-textarea");if(!e)return document.removeEventListener("click",a),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",d),void(n&&(n.removeEventListener("touchstart",l),n.removeEventListener("mousedown",l)));function a(n){const a=n.target;t.contains(a)||e.contains(a)||o.contains(a)||t.classList.contains("open")&&(t.classList.remove("open"),(0,w.A)("check"))}e&&e.addEventListener("click",(function(){if(!t)return;if(!t.getAttribute("dragged")){const n=e.getBoundingClientRect(),o=t.offsetWidth,a=t.offsetHeight;let i=n.left+window.scrollX+n.width/2-o/2;window.getComputedStyle(t).position;let s=n.bottom;s+a>window.innerHeight&&(s=n.top-a),t.style.left=`${i}px`,t.style.top=`${s}px`}t.classList.contains("open")?(t.classList.toggle("open"),(0,w.A)("check")):(t.classList.toggle("open"),(0,w.A)("hide"));t.hasAttribute("initialized")||(!function(){if(!t||!n)return;n.addEventListener("mousedown",l),document.addEventListener("mousemove",c),document.addEventListener("mouseup",d),n.addEventListener("touchstart",l,{passive:!1}),document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",d),e&&document.addEventListener("click",a)}(),t.setAttribute("initialized","true"))}));let i=0,s=0,r=!1;function l(e){r=!0;const n=e.touches?e.touches[0]:e;i=n.clientX-t.offsetLeft,s=n.clientY-t.offsetTop,t.style.transition="none",e.touches&&e.preventDefault()}function c(e){if(!r)return;const n=e.touches?e.touches[0]:e,o=n.clientX-i,a=n.clientY-s;t.style.left=`${o}px`,t.style.top=`${a}px`,t.setAttribute("dragged","true"),e.touches&&e.preventDefault()}function d(){r=!1,t.style.transition=""}const u=document.querySelector(".emotion-box>table tr");u&&u.addEventListener("click",(e=>{if("TH"===e.target.tagName)for(const t of u.querySelectorAll("th")){const n=t.className.match(/(\S+)-bar/);if(!n)return;const o=document.querySelector(`.${n[1]}-container`);t===e.target?(t.classList.add("on-hover"),o.style.display="block"):(t.classList.remove("on-hover"),o.style.display="none")}}))}function E(){if(function(){let e=document.getElementById("iro-annotation-popup");e||(e=document.createElement("div"),e.id="iro-annotation-popup",e.className="iro-annotation-popup",e.innerHTML='<span class="close">×</span><div class="term"></div><div class="explanation"></div>',document.body.appendChild(e),e.querySelector(".close").addEventListener("click",(function(){e.style.display="none"})))}(),!_iro.have_annotation)return;if("string"==typeof _iro.page_annotation&&(_iro.page_annotation=JSON.parse(_iro.page_annotation)),!_iro.page_annotation||0===Object.keys(_iro.page_annotation).length)return;let e=document.querySelectorAll(".iro-term-annotation");const t=new Set;e.forEach((e=>{const n=e.getAttribute("data-term");n&&!t.has(n)&&(e.addEventListener("click",(function(e){if(e.preventDefault(),e.stopPropagation(),_iro.page_annotation&&_iro.page_annotation[n]){let e=_iro.page_annotation[n],t=document.getElementById("iro-annotation-popup");t.querySelector(".term").textContent=n,t.querySelector(".explanation").textContent=e;let o=this.getBoundingClientRect();t.style.top=window.pageYOffset+o.bottom+10+"px",t.style.left=o.left-50+"px",t.style.display="block"}})),t.add(n))})),document.addEventListener("click",(function(e){let t=document.getElementById("iro-annotation-popup");t&&"block"===t.style.display&&!e.target.closest(".iro-term-annotation, .iro-annotation-popup")&&(t.style.display="none")}))}function I(){let e={zh_CN:{submitting:"提交中...",server_error:"服务器错误：",connection_error:"连接错误，请稍后重试",timeout_error:"请求超时，请稍后重试",invalid_url:"请输入有效的网站地址",invalid_email:"请输入有效的邮箱地址",security_error:"安全验证失败，请刷新页面后重试",captcha_load_error:"验证码加载失败，请刷新重试",refresh_captcha:"刷新验证码"},zh_TW:{submitting:"提交中...",server_error:"伺服器錯誤：",connection_error:"連接錯誤，請稍後重試",timeout_error:"請求超時，請稍後重試",invalid_url:"請輸入有效的網站地址",invalid_email:"請輸入有效的郵箱地址",security_error:"安全驗證失敗，請刷新頁面後重試",captcha_load_error:"驗證碼加載失敗，請刷新重試",refresh_captcha:"刷新驗證碼"},ja:{submitting:"送信中...",server_error:"サーバーエラー：",connection_error:"接続エラー、後でもう一度お試しください",timeout_error:"リクエストがタイムアウトしました、後でもう一度お試しください",invalid_url:"有効なURLを入力してください",invalid_email:"有効なメールアドレスを入力してください",security_error:"セキュリティ検証に失敗しました、ページを更新して再試行してください",captcha_load_error:"認証コードの読み込みに失敗しました、更新して再試行してください",refresh_captcha:"認証コードを更新"}},t="zh_CN";try{if(_iro.language)t=_iro.language;else if(document.documentElement.lang){t=document.documentElement.lang.replace(/-/g,"_")}}catch(e){}return e[["zh_CN","zh_TW","ja"].includes(t)?t:"zh_CN"]||e.zh_CN}function S(){let e=I(),t=document.getElementById("openLinkModal"),n=document.getElementById("linkModal"),o=document.querySelector(".link-modal-close"),a=document.getElementById("linkSubmissionForm"),i=document.getElementById("captchaImg");if(!(a&&t&&n&&o&&i))return void(a||document.removeEventListener("pjax:complete",S));let s=document.querySelector(".pattern-header span");function r(e){e.preventDefault(),document.documentElement.style.overflow="hidden",(0,w.A)("hide"),n.style.display="flex",L()}function l(){d(),(0,w.A)("check"),n.style.display="none"}function c(e){e.target===n&&(n.style.display="none",(0,w.A)("check"),d())}function d(){document.documentElement.style.overflowY="unset"}s&&s.parentNode.insertBefore(t,s.nextElementSibling),t.addEventListener("click",r),o.addEventListener("click",l),document.addEventListener("mousedown",c),i.addEventListener("click",L),document.addEventListener("pjax:complete",(function e(){t.removeEventListener("click",r),o.removeEventListener("click",l),document.removeEventListener("mousedown",c),i.removeEventListener("click",L),a.removeEventListener("submit",f),d(),document.removeEventListener("pjax:complete",e)}));let u=!1,m=null,h=!1;async function f(t){if(t.preventDefault(),u||h)console.log("防止重复提交");else{h=!0,await new Promise((e=>setTimeout(e,50)));try{if(clearTimeout(m),u=!0,!function(){let e=I(),t=document.getElementById("siteName"),n=document.getElementById("siteUrl"),o=document.getElementById("siteDescription"),a=document.getElementById("siteImage"),i=document.getElementById("contactEmail"),s=document.getElementById("yzm"),r=document.getElementById("timestamp"),l=document.getElementById("captchaId"),c=document.querySelector('input[name="link_submission_nonce"]');if(!(t&&n&&o&&a&&i&&s&&r&&l&&c.value))return A("error",e.security_error),!1;if(!r.value||!l.value)return A("error",e.captcha_load_error),!1;let d=n.value.trim();/^https?:\/\//i.test(d)||(d="https://"+d,n.value=d);let u=/^https?:\/\/([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(\/[^\s]*)?$/;if(!u.test(d))return A("error",e.invalid_url),!1;let m=a.value.trim();/^https?:\/\//i.test(m)||(m="https://"+m,a.value=m);if(!u.test(m))return A("error",e.invalid_url),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.value.trim()))return A("error",e.invalid_email),!1;let h=/<script[^>]*>[\s\S]*?<\/script>|<[^>]*on\w+\s*=|javascript:|data:/i;if(h.test(t.value)||h.test(o.value)||h.test(d)||h.test(m)||h.test(i.value))return A("error",e.security_error),!1;return!0}())return u=!1,void(h=!1);let n=a.querySelector(".link-form-submit");n&&(n.disabled=!0),A("info",e.submitting);let o=new FormData(a);o.append("action","link_submission");let i=_iro.ajaxurl,s=fetch(i,{method:"POST",body:o,credentials:"same-origin"}),r=new Promise(((t,n)=>{m=setTimeout((()=>{n(new Error(e.timeout_error))}),15e3)})),l=await Promise.race([s,r]);if(clearTimeout(m),!l.ok)throw new Error(`${e.server_error} ${l.status}`);let c,d=await l.text();try{c=JSON.parse(d)}catch(t){throw new Error("服务器返回了无效的JSON响应")}c.success?(A("success",c.data.message),a.reset()):(A("error",c.data.message),L())}catch(t){A("error",t.message||e.connection_error),L()}finally{u=!1;const e=a.querySelector(".link-form-submit");e&&(e.disabled=!1),setTimeout((()=>{h=!1}),1e3)}}}a.addEventListener("submit",f)}function L(){let e=I(),t=document.getElementById("captchaImg"),n=document.getElementById("yzm"),o=document.getElementById("timestamp"),a=document.getElementById("captchaId");if(!(t&&n&&o&&a))return;t.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCIgdmlld0JveD0iMCAwIDM4IDM4IiBzdHJva2U9IiM2NjYiPjxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMSAxKSIgc3Ryb2tlLXdpZHRoPSIyIj48Y2lyY2xlIHN0cm9rZS1vcGFjaXR5PSIuMyIgY3g9IjE4IiBjeT0iMTgiIHI9IjE4Ii8+PHBhdGggZD0iTTM2IDE4YzAtOS45NC04LjA2LTE4LTE4LTE4Ij48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InJvdGF0ZSIgZnJvbT0iMCAxOCAxOCIgdG89IjM2MCAxOCAxOCIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiLz48L3BhdGg+PC9nPjwvZz48L3N2Zz4=",n.value="";let i=_iro.captcha_endpoint||"";if(!i)return void A("error",e.captcha_load_error);let s=Date.now(),r=i+(i.includes("?")?"&":"?")+"t="+s;fetch(r,{method:"GET",credentials:"same-origin",cache:"no-store",headers:{Accept:"application/json"}}).then((t=>{if(!t.ok)throw new Error(e.captcha_load_error);return t.text()})).then((n=>{try{let i=JSON.parse(n);if(void 0!==i.code&&0!==i.code)throw new Error(i.msg||e.captcha_load_error);if(!i.data||!i.id||!i.time)throw new Error(e.captcha_load_error);t.src=i.data,t.classList.remove("error"),o.value=String(i.time),a.value=String(i.id)}catch(t){throw new Error(e.captcha_load_error)}})).catch((n=>{t.classList.add("error"),t.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNlNzRjM2MiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCI+PC9jaXJjbGU+PGxpbmUgeDE9IjE1IiB5MT0iOSIgeDI9IjkiIHkyPSIxNSI+PC9saW5lPjxsaW5lIHgxPSI5IiB5MT0iOSIgeDI9IjE1IiB5Mj0iMTUiPjwvbGluZT48L3N2Zz4=",A("error",e.captcha_load_error),setTimeout(L,3e3)}))}function A(e,t){let n=document.getElementById("formStatus");n&&t&&(window._statusUpdateTimeout&&clearTimeout(window._statusUpdateTimeout),window._statusUpdateTimeout=setTimeout((()=>{let o=t.replace(/[<>"'&]/g,(e=>({"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;"}[e])));n.className="form-status",n.classList.add("success"===e?"success-msg":"error-msg"),n.textContent=o,n.style.display="block","success"===e&&setTimeout((()=>{n&&(n.style.display="none")}),5e3)}),50))}document.addEventListener("DOMContentLoaded",S),document.addEventListener("pjax:complete",S);let k={profile:{display:"block"},header:{minWidth:"",margin:"",background:"",borderBottom:"1px solid rgba(232, 232, 232, 0.8)",padding:"16px"},username:{fontSize:"18px"},avatar:{width:"64px",height:"64px"}};function x(){document.querySelectorAll(".steam-profile")?(C(),q(!0)):q(!1)}function C(){document.querySelectorAll(".steam-profile").forEach((e=>{let t=e.querySelector(".steam-game-info"),n=e.querySelector(".steam-profile-header"),o=e.querySelector(".steam-username");e.offsetWidth>700&&t?(e.style.display="flex",n&&(n.style.minWidth="50%",n.style.margin="0 auto",n.style.background="none",n.style.borderBottom="unset",n.style.padding="24px"),o&&(o.style.fontSize="30px")):(e.style.display=k.profile.display,n&&(n.style.minWidth=k.header.minWidth,n.style.margin=k.header.margin,n.style.background=k.header.background,n.style.borderBottom=k.header.borderBottom,n.style.padding=k.header.padding),o&&(o.style.fontSize=k.username.fontSize))}))}function q(e=!1){let t;function n(){clearTimeout(t),t=setTimeout(C,250)}e?window.addEventListener("resize",n):window.removeEventListener("resize",n)}n(3363),n(9206);var B=n(9998);function T(){const e=localStorage.getItem("dark");e?M("1"==e):(0,B.jo)()&&_iro.darkmode?M(!0):M(!1)}function M(e=!1){let t=document.querySelectorAll(".ghcard");t&&t.forEach((t=>{let n=t.querySelector("img");if(!n)return;let o=new URL(n.src);try{e?(o.searchParams.set("theme","dark"),n.src=o.toString()):(o.searchParams.delete("theme"),n.src=o.toString())}catch(e){}}))}class ${constructor(){this.timelineRoot=null,this.modalMask=null,this.modalContent=null,this.modalClose=null,this.boundHandleClick=this.handleClick.bind(this),this.boundHandleModalClose=this.handleModalClose.bind(this),this.boundHandleMaskClick=this.handleMaskClick.bind(this);const e=(document.documentElement.lang||"").toLowerCase();["zh-hans","zh-cn","zh","zh-hans-cn"].some((t=>e.includes(t)))?this.currentLang="zh-CN":["zh-hant","zh-tw","zh-hant-tw"].some((t=>e.includes(t)))?this.currentLang="zh-TW":e.startsWith("ja")?this.currentLang="ja":e.startsWith("fr")?this.currentLang="fr":this.currentLang="en"}init(){this.timelineRoot=document.getElementById("timeline-root"),this.modalMask=document.getElementById("timeline-modal-mask"),this.modalContent=document.getElementById("timeline-modal-content"),this.modalClose=document.getElementById("timeline-modal-close"),this.modalMain=document.querySelector("#timeline-modal-mask"),this.timelineRoot&&this.modalMask&&this.modalContent&&this.modalClose?(this.contentAPI=this.modalContent.dataset.archiveapi,this.contents="",async function(){await j.FetchContents()}(),this.bindEvents()):document.documentElement.style.overflowY="auto"}async FetchContents(){try{const e=await fetch(this.contentAPI);this.contents=await e.json()}catch(e){console.warn("获取内容失败，重试中...",e);try{const e=await fetch(this.contentAPI);this.contents=await e.json()}catch(e){console.error("获取内容失败:",e)}}}destroy(){this.timelineRoot&&this.timelineRoot.removeEventListener("click",this.boundHandleClick),this.modalClose&&this.modalClose.removeEventListener("click",this.boundHandleModalClose),this.modalMask&&this.modalMask.removeEventListener("click",this.boundHandleMaskClick),document.documentElement.style.overflowY="auto"}bindEvents(){this.timelineRoot.addEventListener("click",this.boundHandleClick),this.modalClose.addEventListener("click",this.boundHandleModalClose),this.modalMask.addEventListener("click",this.boundHandleMaskClick)}handleClick(e){const t=e.target.closest(".timeline-year-card");if(!t)return;if(!this.contents)return;const n=t.dataset.year,o=this.contents[t.dataset.months];this.showYearModal(n,o),this.modalMain.showModal(),document.documentElement.style.overflow="hidden"}handleModalClose(){this.modalMask.classList.remove("active"),this.modalMain.close(),document.documentElement.style.overflowY="auto"}handleMaskClick(e){e.target===this.modalMask&&(this.modalMask.classList.remove("active"),this.modalMain.close(),document.documentElement.style.overflowY="auto")}showYearModal(e,t){let n={posts:0,views:0,words:0,comments:0},o={shuoshuo:{posts:0,views:0,words:0,comments:0},article:{posts:0,views:0,words:0,comments:0}};Object.values(t).forEach((e=>{e.forEach((e=>{if("page"==e.meta.type)return;const t=e.meta.type||"article",a=parseInt(e.meta.views)||0,i=parseInt(e.meta.words)||0,s=parseInt(e.comment_count)||0;n.posts++,n.views+=a,n.words+=i,n.comments+=s,o[t].posts++,o[t].views+=a,o[t].words+=i,o[t].comments+=s}))}));let a={"zh-CN":{yearOverview:"年度总览",articleCount:"投稿数",articles:"文章",shuoshuo:"说说",readCount:"阅读量",times:"次",wordCount:"字数",characters:"字",commentCount:"评论数",comments:"条",month:"月"},"zh-TW":{yearOverview:"年度總覽",articleCount:"投稿數",articles:"文章",shuoshuo:"說說",readCount:"閱讀量",times:"次",wordCount:"字數",characters:"字",commentCount:"評論數",comments:"條",month:"月"},en:{yearOverview:"Year Overview",articleCount:"Posts",articles:"Articles",shuoshuo:"Shuoshuo",readCount:"Views",times:"times",wordCount:"Words",characters:"chars",commentCount:"Comments",comments:"",month:""},ja:{yearOverview:"年間概要",articleCount:"投稿数",articles:"記事",shuoshuo:"つぶやき",readCount:"閲覧数",times:"回",wordCount:"文字数",characters:"字",commentCount:"コメント数",comments:"件",month:"月"},fr:{yearOverview:"Aperçu annuel",articleCount:"Articles",articles:"Articles",shuoshuo:"Shuoshuo",readCount:"Vues",times:"fois",wordCount:"Mots",characters:"caractères",commentCount:"Commentaires",comments:"",month:""}}[this.currentLang],i=`\n            <h2 class="timeline-modal-title">${e} ${a.yearOverview}</h2>\n            <div class="timeline-modal-stats-grid">\n                <div class="timeline-modal-statbox">\n                    <i class="stat-icon fas fa-file-alt"></i>\n                    <span class="stat-label">${a.articleCount}</span>\n                    <span class="stat-value">${n.posts}</span>                    <div class="stat-tooltip">\n                        ${a.articles}：${o.article.posts}<br>\n                        ${a.shuoshuo}：${o.shuoshuo.posts}\n                    </div>\n                </div>\n                <div class="timeline-modal-statbox">\n                    <i class="stat-icon fas fa-eye"></i>\n                    <span class="stat-label">${a.readCount}</span>\n                    <span class="stat-value">${H(n.views)}</span>\n                    <div class="stat-tooltip">${a.articles}：${o.article.views} ${a.times}<br>\n                        ${a.shuoshuo}：${H(o.shuoshuo.views)} ${a.times}\n                    </div>\n                </div>\n                <div class="timeline-modal-statbox">\n                    <i class="stat-icon fas fa-font"></i>\n                    <span class="stat-label">${a.wordCount}</span>\n                    <span class="stat-value">${H(n.words)}</span>\n                    <div class="stat-tooltip">${a.articles}：${H(o.article.words)} ${a.characters}<br>\n                        ${a.shuoshuo}：${H(o.shuoshuo.words)} ${a.characters}\n                    </div>\n                </div>\n                <div class="timeline-modal-statbox">\n                    <i class="stat-icon fas fa-comments"></i>\n                    <span class="stat-label">${a.commentCount}</span>\n                    <span class="stat-value">${n.comments}</span>                    <div class="stat-tooltip">\n                        ${a.articles}：${o.article.comments} ${a.comments}<br>\n                        ${a.shuoshuo}：${o.shuoshuo.comments} ${a.comments}\n                    </div>\n                </div>\n            </div>`;Object.entries(t).sort(((e,t)=>parseInt(t[0])-parseInt(e[0]))).forEach((([e,t])=>{if(t.length){i+=`                    <div class="timeline-modal-month-group">\n                        <h3 class="timeline-modal-month-title">${e}${a.month}</h3>\n                        <div class="timeline-modal-post-list">`;t.slice().sort(((e,t)=>new Date(t.post_date)-new Date(e.post_date))).forEach((e=>{if("page"==e.meta.type)return;const t=new Date(e.post_date),n=`${t.getMonth()+1}-${t.getDate()}`,o="shuoshuo"===e.meta.type?` [${a.shuoshuo}]`:"";i+=`\n                        <a href="${e.guid}" class="timeline-modal-post-item">\n                            <span class="timeline-modal-post-title">${e.post_title}${o}</span>\n                            <span class="timeline-modal-post-date">${n}</span>\n                        </a>`})),i+="</div></div>"}})),this.modalContent.innerHTML=i,this.modalMask.classList.add("active")}}let j=null;function P(){j&&(j.destroy(),j=null),j=new $,j.init()}function H(e){return e>=1e6?(e/1e6).toFixed(2)+"m":e}let N=null,D=null,z=null,O=null,R=null,F=null,W=null,Z=!1,G=null,J=null;function Y(){N&&(document.removeEventListener("visibilitychange",N),N=null),D&&(window.removeEventListener("scroll",D),D=null),z&&(document.removeEventListener("click",z),z=null);const e=document.getElementById("bilibili-favlist-app");e&&O&&(e.removeEventListener("click",O),O=null),R&&(R.disconnect(),R=null),F&&(F.disconnect(),F=null),Z=!1}async function U(){if(!Z){Y(),Z=!0;try{const e=_iro.iro_api,t=_iro.nonce;if(!e)throw new Error("初始化失败：REST API路径不可用");const n={folders:[],currentFolder:null,loading:!0,pageSize:12,currentItems:[],currentPage:1,totalPages:0,error:null,lastDataUpdate:0,fromCache:!1,cacheExpiresIn:0,cacheAge:0,cache:new Map},o={getKey:(e,t)=>`folder_${e}_page_${t}`,set:(e,t,a)=>{const i=o.getKey(e,t);n.cache.set(i,{timestamp:Date.now(),data:a});try{const n=`bilibili_favlist_${e}_${t}`;localStorage.setItem(n,JSON.stringify({timestamp:Date.now(),data:a}))}catch(e){}},get:(e,t)=>{const a=o.getKey(e,t);let i=n.cache.get(a);if(!i)try{const o=`bilibili_favlist_${e}_${t}`,s=localStorage.getItem(o);if(s){const e=JSON.parse(s);e&&e.timestamp&&Date.now()-e.timestamp<432e5?(n.cache.set(a,e),i=e):localStorage.removeItem(o)}}catch(e){}return i},isValid:e=>!!e&&Date.now()-e.timestamp<432e5};async function a(){try{await i(),c(),v(),b(),F=I(),S(),A(),E()}catch(e){l(`加载收藏夹失败: ${e.message||"未知错误"}<br>请刷新页面重试`)}}async function i(o=!1){if(n.loading=!0,c(),!o)try{const e=localStorage.getItem("bilibili_favlist_folders");if(e){const t=JSON.parse(e);if(t&&t.timestamp&&Date.now()-t.timestamp<432e5){if(n.folders=t.folders,n.folders?.length)return n.currentFolder=n.currentFolder||n.folders[0].id,void await s(n.currentFolder,1,!1)}else localStorage.removeItem("bilibili_favlist_folders")}}catch(e){}const a=`${e}/favlist/bilibili/folders`;try{let e=`${a}?_wpnonce=${t}`;o&&(e+=`&_t=${Date.now()}`);const i=await fetch(e,{headers:{"Cache-Control":o?"no-cache, no-store, must-revalidate":"max-age=43200",Pragma:o?"no-cache":void 0}});if(!i.ok)throw new Error(`网络请求失败 (${i.status})`);const r=await i.json();if(0!==r.code)throw new Error(r.message||"获取收藏夹列表失败");if(n.folders=r.data.list||[],n.folders?.length){try{localStorage.setItem("bilibili_favlist_folders",JSON.stringify({timestamp:Date.now(),folders:n.folders}))}catch(e){}n.currentFolder=n.folders[0].id,await s(n.currentFolder,1,o)}else n.loading=!1,n.currentItems=[],n.totalPages=0,c()}catch(e){l("加载收藏夹列表失败，请刷新页面重试"),n.loading=!1,c()}}async function s(e,t=1,a=!1){if(n.loading=!0,n.error=null,n.currentPage=t,n.currentFolder=e,c(),!a){const a=o.get(e,t);if(o.isValid(a)){const e=a.data;return n.currentItems=e.medias||[],n.totalPages=Math.ceil((e.info?.media_count||0)/n.pageSize),n.fromCache=!0,n.cacheAge=Math.floor((Date.now()-a.timestamp)/1e3),n.loading=!1,void c(!0)}}await r(e,t,a)}async function r(a,i=1,s=!1){const r=`${e}/favlist/bilibili`;try{let e=`${r}?folder_id=${a}&page=${i}&_wpnonce=${t}`;s&&(e+=`&_t=${Date.now()}`);const l=await fetch(e,{headers:{"Cache-Control":s?"no-cache, no-store, must-revalidate":"max-age=43200",Pragma:s?"no-cache":void 0}});if(!l.ok)throw new Error(`网络请求失败 (${l.status})`);const c=await l.json();if(0!==c.code)throw new Error(c.message||"获取收藏内容失败");const d=c.data;o.set(a,i,d),n.currentItems=d.medias||[],n.totalPages=Math.ceil((d.info?.media_count||0)/n.pageSize),n.fromCache=c.cache_info?.from_cache||!1,n.cacheExpiresIn=c.cache_info?.expires_in||0,n.lastDataUpdate=Date.now()}catch(e){l(`加载收藏内容失败: ${e.message}. 请重试`),n.currentItems=[],n.totalPages=0}finally{n.loading=!1,c(!0)}}function l(e){n.error=e,n.loading=!1}function c(e=!1){const t=n.folders.length>0?u():"";let o="";o=n.error?`\n                    <div class="fav-section">\n                    <div class="fav-content">\n                    <div class="fav-empty">\n                    <p>${n.error}</p>\n                    <button class="page-btn retry-btn">重试</button>\n                    </div>\n                    </div>\n                    </div>\n                `:n.loading&&!n.currentItems.length?d():n.folders.length||n.loading?m():'\n                    <div class="fav-section">\n                    <div class="fav-content">\n                    <div class="fav-empty">\n                    <p>没有找到收藏夹或UID配置错误。</p>\n                        <button class="page-btn retry-btn">重试</button>\n                    </div>\n                    </div>\n                    </div>\n                ';const a=J.querySelector(".fav-section"),i=a&&a.querySelector(".fav-item-skeleton"),s=()=>{if(J.innerHTML=t+o,g(),!n.loading&&!n.error&&n.currentItems.length>0){J.querySelectorAll(".fav-item").forEach(((e,t)=>{e.classList.add("fav-item-enter"),e.style.transitionDelay=30*t+"ms",requestAnimationFrame((()=>{e&&e.parentNode&&e.classList.remove("fav-item-enter")}))})),F&&F.disconnect(),F=I(),E()}else F&&F.disconnect(),F=null,D&&window.removeEventListener("scroll",D),D=null};if(e&&a&&!i&&!n.loading&&!n.error){const e=a.querySelectorAll(".fav-item");if(e.length>0){const t=400+50*(e.length-1);e.forEach(((e,t)=>{requestAnimationFrame((()=>{e&&e.parentNode&&(e.style.transitionDelay=50*t+"ms",e.classList.add("fav-item-exit"),setTimeout((()=>{e&&e.parentNode&&(e.style.transitionDelay="")}),400+50*t))}))}));const n=Math.max(400,t-100);setTimeout(s,n)}else s()}else s()}function d(){let e='<div class="fav-section"><div class="fav-content"><div class="fav-grid">';for(let t=0;t<n.pageSize;t++)e+='\n                    <div class="fav-item fav-item-skeleton">\n                    <div class="fav-item-content-wrapper">\n                    <div class="fav-item-thumb">\n                    <div class="fav-item-thumb-placeholder"></div>\n                    </div>\n                    <div class="fav-item-desc-wrapper">\n                    <div class="fav-item-desc"></div>\n                    <div class="fav-item-desc"></div>\n                    </div>\n                    </div>\n                    </div>\n                ';return e+="</div></div></div>",e}function u(){let e="";return G&&(e='\n                    <div class="fav-tab refresh-btn" title="强制刷新数据 (仅管理员可见)">\n                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">\n                    <path d="M3 2v6h6"></path>\n                    <path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path>\n                    <path d="M21 22v-6h-6"></path>\n                    <path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path>\n                    </svg>\n                    <span class="refresh-text">刷新</span>\n                    </div>\n                '),`\n                <div class="fav-tabs">\n                ${n.folders.map((e=>`\n                            <div class="fav-tab ${e.id===n.currentFolder?"active":""}"\n                            data-folder-id="${e.id}">\n                            ${e.title}\n                            <span class="fav-tab-count">${e.media_count}</span>\n                            </div>\n                        `)).join("")}\n                ${e}\n                </div>\n            `}function m(){n.folders.find((e=>e.id===n.currentFolder));let e="";return n.currentItems.length||n.loading?n.currentItems.length&&(e=`\n                    <div class="fav-grid">\n                    ${n.currentItems.map((e=>h(e))).join("")}\n                    </div>\n                    ${f()}\n                `):e='<div class="fav-empty"><p>该收藏夹暂无内容</p></div>',`\n                <div class="fav-section">\n                <div class="fav-content">\n                ${e}\n                </div>\n                </div>\n            `}function h(e){let t=e.bvid||"",n=e.cover?e.cover.replace(/^http:/,"https:"):"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";return`\n                <div class="fav-item" data-bvid="${t}" data-title="${e.title}" data-up="${e.upper?.name||"未知"}" tabindex="0" role="button" aria-label="播放视频: ${e.title}">\n                <div class="fav-item-content-wrapper">\n                <div class="fav-item-thumb">\n                <div class="fav-item-thumb-placeholder">\n                \x3c!-- 移除 spinner --\x3e\n                </div>\n                <img data-src="${n}" class="fav-thumb-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" referrerpolicy="no-referrer" alt="${e.title}">\n                <div class="fav-item-title-area">\n                <h3 class="fav-item-title" title="${e.title}">${e.title}</h3>\n                </div>\n                <div class="fav-item-up">\n                <span class="up-name">UP: ${e.upper?.name||"未知"}</span>\n                </div>\n                <div class="fav-item-play-btn">\n                <svg viewBox="0 0 24 24" width="36" height="36" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8" fill="currentColor"></polygon></svg>\n                </div>\n                </div>\n                <div class="fav-item-desc-wrapper">\n                <div class="fav-item-desc" title="${e.intro||""}">${e.intro||"暂无简介"}</div>\n                </div>\n                </div>\n                </div>\n            `}function f(){if(n.totalPages<=1)return"";let e='<div class="fav-pagination">';const t=n.currentPage,o=n.totalPages;e+=`<button class="page-btn prev-btn" ${t<=1?"disabled":""} data-page="${t-1}">上一页</button>`;let a=Math.max(1,t-Math.floor(2.5)),i=Math.min(o,a+5-1);i-a+1<5&&(a=Math.max(1,i-5+1)),a>1&&(e+='<button class="page-btn page-num" data-page="1">1</button>',a>2&&(e+='<button class="page-btn page-ellipsis" disabled>...</button>'));for(let n=a;n<=i;n++)e+=`<button class="page-btn page-num ${n===t?"active":""}" data-page="${n}">${n}</button>`;return i<o&&(i<o-1&&(e+='<button class="page-btn page-ellipsis" disabled>...</button>'),e+=`<button class="page-btn page-num" data-page="${o}">${o}</button>`),e+=`<button class="page-btn next-btn" ${t>=o?"disabled":""} data-page="${t+1}">下一页</button>`,e+="</div>",e}function g(){O&&J.removeEventListener("click",O),O=async function(e){const t=e.target,a=t.closest(".refresh-btn");if(G&&a&&!a.classList.contains("refreshing")){const e=parseInt(localStorage.getItem("bilibili_last_refresh_ts")||"0",10),t=Date.now(),s=6e4-(t-e),r=a.querySelector(".refresh-text");if(s>0){if(r){r.textContent;r.textContent=`请稍后 (${Math.ceil(s/1e3)}s)`,setTimeout((()=>{const e=J.querySelector(".refresh-btn"),t=e?.querySelector(".refresh-text");t&&t.textContent.startsWith("请稍后")&&(t.textContent="刷新")}),s)}return}localStorage.setItem("bilibili_last_refresh_ts",t.toString()),a.classList.add("refreshing"),r&&(r.textContent="刷新中...");try{if(localStorage.removeItem("bilibili_favlist_folders"),n.currentFolder){for(let e=1;e<=n.totalPages;e++)localStorage.removeItem(`bilibili_favlist_${n.currentFolder}_${e}`),n.cache.delete(o.getKey(n.currentFolder,e));localStorage.removeItem(`bilibili_favlist_${n.currentFolder}_${n.currentPage}`),n.cache.delete(o.getKey(n.currentFolder,n.currentPage))}n.cache=new Map,await i(!0)}catch(e){l("刷新失败，请稍后重试"),c()}finally{const e=J.querySelector(".refresh-btn");if(e){e.classList.remove("refreshing");const t=e.querySelector(".refresh-text");t&&(t.textContent="刷新")}}return}const r=t.closest(".fav-tab:not(.refresh-btn)");if(r){const e=parseInt(r.dataset.folderId,10);return e===n.currentFolder||n.loading?void 0:void await s(e,1)}const d=t.closest(".page-btn[data-page]");if(d&&!d.disabled&&!d.classList.contains("active")){const e=parseInt(d.dataset.page,10);return void(e===n.currentPage||n.loading||(await s(n.currentFolder,e),y()))}if(t.closest(".retry-btn")){n.error=null,n.loading=!0,c();try{await i(!1)}catch(e){l(`重试失败: ${e.message}`),c()}}else;},J.addEventListener("click",O)}function p(){let e=Date.now(),t=!1;N=function(){const o=Date.now();if("hidden"===document.visibilityState)e=o;else if("visible"===document.visibilityState){const a=o-e;Z&&!n.loading&&n.folders.length>0&&(a>3e5||t)&&(s(n.currentFolder,n.currentPage,!1),t=!1)}},document.addEventListener("visibilitychange",N)}function v(){g(),p()}function y(){const e=J.querySelector(".fav-section");e&&window.scrollTo({top:e.offsetTop-80,behavior:"smooth"})}function b(){const e=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(t.target.classList.add("visible"),e.unobserve(t.target))}))}),{threshold:.1,rootMargin:"0px 0px -50px 0px"});J.querySelectorAll(".fav-item:not(.visible)").forEach(((t,n)=>{t.style.animationDelay=.05*n+"s",e.observe(t)}))}function w(e){for(const t of e)"childList"===t.type&&t.addedNodes.forEach((e=>{1===e.nodeType&&(e.classList.contains("fav-item")&&b(),e.querySelectorAll("img.fav-thumb-img[data-src]").forEach((e=>{F&&F.observe(e)})))}))}function _(e,t=50){let n;return function(...o){clearTimeout(n),n=setTimeout((()=>e.apply(this,o)),t)}}function E(){D&&window.removeEventListener("scroll",D),D=_((()=>{const e=J.querySelectorAll(".fav-item:not(.visible):not(.fav-item-exit)"),t=window.innerHeight;e.forEach((e=>{const n=e.getBoundingClientRect();n.top<.9*t&&n.bottom>.1*t&&e.classList.add("visible")}))}),50),window.addEventListener("scroll",D),requestAnimationFrame(D)}function I(){F&&F.disconnect();const e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const n=e.target,o=n.getAttribute("data-src");if(o){const e=n.previousElementSibling;n.onload=()=>{n.classList.add("loaded"),e&&e.classList.contains("fav-item-thumb-placeholder")&&(e.style.display="none")},n.onerror=()=>window.imgError(this),n.src=o,n.removeAttribute("data-src")}t.unobserve(n)}}))}),{threshold:.05,rootMargin:"150px"});return J&&J.querySelectorAll("img.fav-thumb-img[data-src]").forEach((t=>e.observe(t))),e}function S(){function e(){if(!W)return;const e=W.querySelector(".video-modal-container"),t=W.querySelector(".video-modal-iframe");e.style.transform="translateY(20px)",e.style.opacity="0",setTimeout((()=>{W.classList.remove("active"),W.close(),document.body.style.overflow="",t&&(t.src="about:blank")}),300)}return W=document.querySelector(".video-modal"),W.querySelector(".video-modal-close").addEventListener("click",e),W.addEventListener("click",(t=>{t.target===W&&e()})),W}function L(e){const t=e.getAttribute("data-bvid");if(t&&W){const n=e.getAttribute("data-title"),o=e.getAttribute("data-up");W.querySelector(".video-modal-title").textContent=n,W.querySelector(".video-modal-up-name").textContent="UP: "+o,W.querySelector(".video-modal-open").href=`https://www.bilibili.com/video/${t}`;W.querySelector(".video-modal-iframe").src=`https://player.bilibili.com/player.html?bvid=${t}&page=1&autoplay=1&danmaku=1`,W.showModal(),W.classList.add("active"),document.body.style.overflow="hidden",setTimeout((()=>{if(W){const e=W.querySelector(".video-modal-container");e&&(e.style.transform="translateY(0)",e.style.opacity="1")}}),10)}}function A(){z&&document.removeEventListener("click",z),z=e=>{const t=e.target.closest(".fav-item");t&&(e.preventDefault(),L(t))},document.addEventListener("click",z)}await a(),R&&R.disconnect(),R=new MutationObserver(w),J&&R.observe(J,{childList:!0,subtree:!0})}catch(k){J&&(J.innerHTML=`\n                <div class="fav-empty">\n                <p>加载收藏夹时发生严重错误: ${k.message||"未知错误"}</p>\n                <button class="page-btn retry-btn">重试</button>\n                </div>\n            `,J.querySelector(".retry-btn")?.addEventListener("click",U)),Z=!1}}}function V(){if(0!=_iro.post_theme_color&&"false"!=_iro.post_theme_color){let e=_iro.post_theme_color;document.documentElement.style.setProperty("--article-theme-highlight",e)}else document.documentElement.style.removeProperty("--article-theme-highlight")}function X(){document.getElementsByClassName("comment_inline_img").length&&document.getElementsByClassName("comments-main")[0].addEventListener("click",(function(e){e.target.classList.contains("comment_inline_img")&&window.open(e.target.src)}))}function K(){document.getElementsByClassName("emoji-item").length&&document.querySelector(".menhera-container").addEventListener("click",(function(e){e.target.classList.contains("emoji-item")&&grin(e.target.innerText,"custom","`","` ")}))}function Q(){const e="commentwrap",t=document.getElementById("commentform");if(t){let n=!1;t.addEventListener("submit",(function(t){if(t.stopPropagation(),t.preventDefault(),n)return;const o=(0,c.I)((0,p.__)("提交中...."),!0),a=new FormData(this);a.append("action","ajax_comment"),n=!0,fetch(_iro.ajaxurl,{method:this.attributes.method.value,body:a}).then((async t=>{const n=await t.text();if(t.ok){Array.from(document.getElementsByTagName("textarea")).forEach((e=>e.value=""));const t=document.getElementById("cancel-comment-reply-link"),o=document.getElementById("wp-temp-form-div"),a=document.getElementById(g.respondId);"0"!=document.getElementById("comment_parent").value?document.getElementById("respond").insertAdjacentHTML("beforebegin",'<ol class="children">'+n+"</ol>"):document.getElementsByClassName(e).length?"asc"==_iro.order?document.getElementsByClassName("commentwrap")[1].insertAdjacentHTML("beforeend",n):document.getElementsByClassName("commentwrap")[1].insertAdjacentHTML("afterbegin",n):"bottom"==_iro.formpostion?document.getElementById("respond").insertAdjacentHTML("beforebegin",'<ol class="'+e+'">'+n+"</ol>"):document.getElementById("respond").insertAdjacentHTML("afterend",'<ol class="'+e+'">'+n+"</ol>"),(0,c.I)((0,p.__)("提交成功")),document.dispatchEvent(new CustomEvent("ajax_comment_complete")),t.style.display="none",t.onclick=null,document.getElementById("comment_parent").value="0",o&&a&&(o.parentNode.insertBefore(a,o),o.remove())}else(0,c.I)(n||"HTTP"+t.status+":"+t.statusText)})).catch((e=>{(0,c.I)(e)})).finally((()=>{o.remove(),n=!1}))}))}}function ee(){let e=document.getElementsByClassName("sm"),t=document.querySelector(".comments-main");e.length&&t&&(t.addEventListener("click",(function(e){if(e.target.classList.contains("comment-reply-link")){e.preventDefault(),e.stopPropagation();let t=e.target.getAttribute("data-commentid");g.moveForm("comment-"+t,t,"respond",this.getAttribute("data-postid"))}})),t.addEventListener("click",(e=>{let t=e.target.parentNode;if(t.classList.contains("sm")){let e=(0,p.__)("您真的要设为私密吗？");if(1==confirm(e)){if(t.classList.contains("private_now"))return alert((0,p.__)("您之前已设过私密评论")),!1;{t.classList.add("private_now");let e=t.getAttribute("data-idp"),n=t.getAttribute("data-actionp"),o=t.getElementsByClassName("has_set_private")[0],a="action=siren_private&p_id="+e+"&p_action="+n,i=new XMLHttpRequest;return i.onreadystatechange=function(){4==this.readyState&&200==this.status&&(o.innerHTML=i.responseText)},i.open("POST",_iro.ajaxurl,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(a),!1}}}})))}function te(){const e=document.querySelector(".toc-container"),t=document.querySelector(".site-content");if(e&&t){const n=()=>{e.style.height=Math.min(t.getBoundingClientRect().height,document.documentElement.offsetHeight-e.offsetTop)+"px"};n(),window.addEventListener("resize",function(e,t=166){let n;function o(...o){clearTimeout(n),n=setTimeout((()=>{e.apply(this,o)}),t)}return o.clear=()=>{clearTimeout(n)},o}(n),{passive:!0}),document.addEventListener("scroll",function(e,t,n){let o=null,a=Date.parse(new Date);return function(){null!==o&&clearTimeout(o);let i=Date.parse(new Date);i-a>=n?(e(),a=i):o=setTimeout(e,t)}}(n,200,1e3))}}function ne(e){let t=document.getElementsByClassName("toc-container")[0];if(document.querySelector("div.have-toc")||document.querySelector("div.has-toc")){if(t&&(t.style.display=""),e&&document.getElementsByClassName("toc").length>0){n.e(8915).then(n.bind(n,8915)).then((({default:t})=>{t.init({tocSelector:"#main-container .toc",contentSelector:[".entry-content",".links"],headingSelector:"h1,h2,h3,h4,h5",headingsOffset:e-window.innerHeight/2,onClick:null})}));const e="sakurairo"==_iro.entry_content_style?document.querySelector("article.type-post")?document.querySelector("div.pattern-attachment")?-75:200:375:window.innerHeight/2,t=document.querySelectorAll(".entry-content,.links"),o=new Set;let a=1;for(let e=0;e<t.length;e++){let n=t[e].querySelectorAll("h1,h2,h3,h4,h5");for(const e of n){const t=oe(e.innerText,o,a);o.has(t)?e.id="toc-head-"+a++:(e.id=t,o.add(t))}}}document.dispatchEvent(new CustomEvent("tocEvent",{detail:!0}))}else t&&(t.style.display="none"),document.dispatchEvent(new CustomEvent("tocEvent",{detail:!1}))}function oe(e,t,n){let o=e.trim().replace(/\s+/g,"-");for(o=o.replace(/[^\w\-]/g,""),o||(o="heading-"+n);t.has(o);)o+="-"+n;return t.add(o),o}function ae(){if(null==document.querySelector(".form-submit #submit"))return;if(!_iro.comment_upload_img)return;!function(){let e=document.getElementsByClassName("insert-image-tips")[0],t=document.getElementById("upload-img-file");t&&t.addEventListener("change",(function(){if(this.files.length>10)return(0,c.I)((0,p.__)("每次上传上限为10张")),0;for(let e=0;e<this.files.length;e++)if(this.files[e].size>=5242880)return void alert((0,p._$)("图片上传大小限制为5 MB\n\n「{0}」\n\n这张图太大啦~请重新上传噢！",this.files[e].name));for(let t=0;t<this.files.length;t++){let n=this.files[t],o=new FormData,i=new XMLHttpRequest;o.append("cmt_img_file",n),i.addEventListener("loadstart",(function(){e.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i>',(0,c.I)((0,p.__)("上传中..."))})),i.open("POST",(0,a.tG)(_iro.api+"sakura/v1/image/upload"),!0),i.send(o),i.onreadystatechange=function(){if(4!=i.readyState||200!=i.status&&304!=i.status)4==i.readyState&&(e.innerHTML='<i class="fa-regular fa-clock" aria-hidden="true" style="color:red"></i>',alert((0,p.__)("上传失败，请重试.")),setTimeout((function(){e.innerHTML='<i class="fa-regular fa-image"></i>'}),1e3));else{e.innerHTML='<i class="fa-solid fa-check"></i>',setTimeout((function(){e.innerHTML='<i class="fa-regular fa-image"></i>'}),1e3);let t=JSON.parse(i.responseText);if(200==t.status){let e=t.proxy;document.getElementById("upload-img-show").insertAdjacentHTML("afterend",'<img class="lazyload upload-image-preview" src="'+_iro.loading_ph+'" data-src="'+e+'" onclick="window.open(\''+e+'\')" onerror="imgError(this)" />'),(0,l.A)(),(0,c.I)((0,p.__)("图片上传成功~")),grin(e,type="Img")}else(0,c.I)((0,p._$)("上传失败！\n文件名: {0}\ncode: {1}\n{2}",n.name,t.status,t.message),3e3)}}}}))}();const e=document.getElementById("upload-img-file"),t=document.getElementsByClassName("insert-image-tips")[0],n=document.getElementById("uploadTipPopup");e&&(e.addEventListener("mouseenter",(function(){t.classList.toggle("insert-image-tips-hover"),n.classList.toggle("show")})),e.addEventListener("mouseleave",(function(){t.classList.toggle("insert-image-tips-hover"),n.classList.toggle("show")})))}function ie(){(0,l.A)(),(0,b.xI)(),X(),document.getElementById("upload-img-show").innerHTML=""}function se(){r(),ee()}window.addEventListener("popstate",se),X(),(0,b.xI)(),y(),ee(),K(),_(),ne(!0),document.querySelectorAll(".comt-addsmilies").forEach((e=>{e.addEventListener("click",(()=>{"block"==e.stlye.display?e.style.display="none":e.style.display="block"}))})),document.querySelectorAll(".comt-smilies a").forEach((e=>{e.addEventListener("click",(()=>{e.parentNode.style.display="none"}))})),te(),E(),V(),document.addEventListener("ajax_comment_complete",ie),S(),x(),P(),function(){function e(){J=document.getElementById("bilibili-favlist-app"),G=_iro.is_admin,J?U():Y()}document.addEventListener("pjax:complete",e),e()}(),document.addEventListener("pjax:complete",(function(){try{ae(),r(),y(),ne(!0),X(),h(),ee(),K(),(0,b.xI)(),_(),Q(),te(),E(),V(),S(),x(),P()}catch(e){console.warn(e)}})),(0,a.Gc)((function(){r(),Q(),document.body.addEventListener("click",(function(e){if(e.target.parentNode==document.getElementById("comments-navi")&&"a"==e.target.nodeName.toLowerCase()){e.preventDefault(),e.stopPropagation();let t=e.target,n=t.pathname,o=new XMLHttpRequest;o.open("GET",t.getAttribute("href"),!0),o.responseType="document",o.onloadstart=()=>{let e=document.getElementById("comments-navi"),t=document.querySelector("ul.commentwrap"),n=document.getElementById("loading-comments"),o=document.getElementById("comments-list-title");e.remove(),t.remove(),n.style.display="block",(0,a.mf)(n,500,"show"),window.scrollTo({top:o.getBoundingClientRect().top+window.pageYOffset-o.clientTop-65,behavior:"smooth"})},o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){let e=o.response,t=e.querySelector("ul.commentwrap"),i=e.getElementById("comments-navi"),s=document.getElementById("loading-comments");(0,a.mf)(s,200,"hide"),document.getElementById("loading-comments").insertAdjacentHTML("afterend",t.outerHTML),document.querySelector("ul.commentwrap").insertAdjacentHTML("afterend",i.outerHTML),(0,l.A)(),window.gtag&&gtag("config",_iro.google_analytics_id,{page_path:n}),(0,b.xI)(),X();let r=document.querySelector("ul.commentwrap");window.scrollTo({top:r&&r.getBoundingClientRect().top+window.pageYOffset-r.clientTop-200,behavior:"smooth"})}},o.send()}})),h(),ae(),document.addEventListener("darkmode",(e=>{M(e.detail)})),document.addEventListener("pjax:complete",(function(){T()})),T()}))},1539:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=t},7635:e=>{var t,n;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,o=0;n<e.length;n++,o+=8)t[o>>>5]|=e[n]<<24-o%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],o=0;o<e.length;o+=3)for(var a=e[o]<<16|e[o+1]<<8|e[o+2],i=0;i<4;i++)8*o+6*i<=8*e.length?n.push(t.charAt(a>>>6*(3-i)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],o=0,a=0;o<e.length;a=++o%4)0!=a&&n.push((t.indexOf(e.charAt(o-1))&Math.pow(2,-2*a+8)-1)<<2*a|t.indexOf(e.charAt(o))>>>6-2*a);return n}},e.exports=n},3445:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},5892:(e,t,n)=>{var o,a,i,s,r;o=n(7635),a=n(1539).utf8,i=n(3445),s=n(1539).bin,(r=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?s.stringToBytes(e):a.stringToBytes(e):i(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var n=o.bytesToWords(e),l=8*e.length,c=1732584193,d=-271733879,u=-1732584194,m=271733878,h=0;h<n.length;h++)n[h]=16711935&(n[h]<<8|n[h]>>>24)|4278255360&(n[h]<<24|n[h]>>>8);n[l>>>5]|=128<<l%32,n[14+(l+64>>>9<<4)]=l;var f=r._ff,g=r._gg,p=r._hh,v=r._ii;for(h=0;h<n.length;h+=16){var y=c,b=d,w=u,_=m;c=f(c,d,u,m,n[h+0],7,-680876936),m=f(m,c,d,u,n[h+1],12,-389564586),u=f(u,m,c,d,n[h+2],17,606105819),d=f(d,u,m,c,n[h+3],22,-1044525330),c=f(c,d,u,m,n[h+4],7,-176418897),m=f(m,c,d,u,n[h+5],12,1200080426),u=f(u,m,c,d,n[h+6],17,-1473231341),d=f(d,u,m,c,n[h+7],22,-45705983),c=f(c,d,u,m,n[h+8],7,1770035416),m=f(m,c,d,u,n[h+9],12,-1958414417),u=f(u,m,c,d,n[h+10],17,-42063),d=f(d,u,m,c,n[h+11],22,-1990404162),c=f(c,d,u,m,n[h+12],7,1804603682),m=f(m,c,d,u,n[h+13],12,-40341101),u=f(u,m,c,d,n[h+14],17,-1502002290),c=g(c,d=f(d,u,m,c,n[h+15],22,1236535329),u,m,n[h+1],5,-165796510),m=g(m,c,d,u,n[h+6],9,-1069501632),u=g(u,m,c,d,n[h+11],14,643717713),d=g(d,u,m,c,n[h+0],20,-373897302),c=g(c,d,u,m,n[h+5],5,-701558691),m=g(m,c,d,u,n[h+10],9,38016083),u=g(u,m,c,d,n[h+15],14,-660478335),d=g(d,u,m,c,n[h+4],20,-405537848),c=g(c,d,u,m,n[h+9],5,568446438),m=g(m,c,d,u,n[h+14],9,-1019803690),u=g(u,m,c,d,n[h+3],14,-187363961),d=g(d,u,m,c,n[h+8],20,1163531501),c=g(c,d,u,m,n[h+13],5,-1444681467),m=g(m,c,d,u,n[h+2],9,-51403784),u=g(u,m,c,d,n[h+7],14,1735328473),c=p(c,d=g(d,u,m,c,n[h+12],20,-1926607734),u,m,n[h+5],4,-378558),m=p(m,c,d,u,n[h+8],11,-2022574463),u=p(u,m,c,d,n[h+11],16,1839030562),d=p(d,u,m,c,n[h+14],23,-35309556),c=p(c,d,u,m,n[h+1],4,-1530992060),m=p(m,c,d,u,n[h+4],11,1272893353),u=p(u,m,c,d,n[h+7],16,-155497632),d=p(d,u,m,c,n[h+10],23,-1094730640),c=p(c,d,u,m,n[h+13],4,681279174),m=p(m,c,d,u,n[h+0],11,-358537222),u=p(u,m,c,d,n[h+3],16,-722521979),d=p(d,u,m,c,n[h+6],23,76029189),c=p(c,d,u,m,n[h+9],4,-640364487),m=p(m,c,d,u,n[h+12],11,-421815835),u=p(u,m,c,d,n[h+15],16,530742520),c=v(c,d=p(d,u,m,c,n[h+2],23,-995338651),u,m,n[h+0],6,-198630844),m=v(m,c,d,u,n[h+7],10,1126891415),u=v(u,m,c,d,n[h+14],15,-1416354905),d=v(d,u,m,c,n[h+5],21,-57434055),c=v(c,d,u,m,n[h+12],6,1700485571),m=v(m,c,d,u,n[h+3],10,-1894986606),u=v(u,m,c,d,n[h+10],15,-1051523),d=v(d,u,m,c,n[h+1],21,-2054922799),c=v(c,d,u,m,n[h+8],6,1873313359),m=v(m,c,d,u,n[h+15],10,-30611744),u=v(u,m,c,d,n[h+6],15,-1560198380),d=v(d,u,m,c,n[h+13],21,1309151649),c=v(c,d,u,m,n[h+4],6,-145523070),m=v(m,c,d,u,n[h+11],10,-1120210379),u=v(u,m,c,d,n[h+2],15,718787259),d=v(d,u,m,c,n[h+9],21,-343485551),c=c+y>>>0,d=d+b>>>0,u=u+w>>>0,m=m+_>>>0}return o.endian([c,d,u,m])})._ff=function(e,t,n,o,a,i,s){var r=e+(t&n|~t&o)+(a>>>0)+s;return(r<<i|r>>>32-i)+t},r._gg=function(e,t,n,o,a,i,s){var r=e+(t&o|n&~o)+(a>>>0)+s;return(r<<i|r>>>32-i)+t},r._hh=function(e,t,n,o,a,i,s){var r=e+(t^n^o)+(a>>>0)+s;return(r<<i|r>>>32-i)+t},r._ii=function(e,t,n,o,a,i,s){var r=e+(n^(t|~o))+(a>>>0)+s;return(r<<i|r>>>32-i)+t},r._blocksize=16,r._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var n=o.wordsToBytes(r(e,t));return t&&t.asBytes?n:t&&t.asString?s.bytesToString(n):o.bytesToHex(n)}}},e=>{e.O(0,[8538],(()=>{return t=421,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=page.js.map